<!doctype html>




<html class="theme-next mist" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>






<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />





















  

<link href="https://cdn.bootcss.com/font-awesome/4.6.2/css/font-awesome.min.css" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Jason,博客" />





  <link rel="alternate" href="/atom.xml" title="Jason" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="本来，标题是「揭开 macOS 开发的神秘面纱」，可想想，以我目前对 macOS 开发的理解，还是去掉「揭开」二字吧 😂 本文不是系统性的文章，更像是 随笔。回想自己过去 1.6 年的 macOS 开发历程，挑些有意思的来说。如果想看完就去挖 macOS 这座金矿（如果是的话），你会失望的；且作佚事来读吧。 注：严格地说，应该叫作「macOS 开发」，因为去年起，苹果将 Mac 操作系统更名为">
<meta name="keywords">
<meta property="og:type" content="article">
<meta property="og:title" content="Mac 开发的神秘面纱：后娘养的嫡长子">
<meta property="og:url" content="https://atjason.com/IndieDev/2017-07-18.html">
<meta property="og:site_name" content="Jason">
<meta property="og:description" content="本来，标题是「揭开 macOS 开发的神秘面纱」，可想想，以我目前对 macOS 开发的理解，还是去掉「揭开」二字吧 😂 本文不是系统性的文章，更像是 随笔。回想自己过去 1.6 年的 macOS 开发历程，挑些有意思的来说。如果想看完就去挖 macOS 这座金矿（如果是的话），你会失望的；且作佚事来读吧。 注：严格地说，应该叫作「macOS 开发」，因为去年起，苹果将 Mac 操作系统更名为">
<meta property="og:image" content="https://ps.toolinbox.net/bx86a.png">
<meta property="og:image" content="https://ps.toolinbox.net/syxbc.jpg">
<meta property="og:image" content="https://ps.toolinbox.net/734na.jpg">
<meta property="og:image" content="https://ps.toolinbox.net/qg8nb.jpg">
<meta property="og:image" content="https://ps.toolinbox.net/d40yo.jpg">
<meta property="og:image" content="https://ps.toolinbox.net/vsz2g.jpg">
<meta property="og:image" content="https://ps.toolinbox.net/5pb5e.jpg">
<meta property="og:image" content="https://ps.toolinbox.net/1h5z5.jpg">
<meta property="og:image" content="https://ps.toolinbox.net/th82z.png">
<meta property="og:image" content="https://ps.toolinbox.net/xnxnn.png">
<meta property="og:image" content="https://ps.toolinbox.net/jxzr4.jpg">
<meta property="og:image" content="https://ps.toolinbox.net/z997y.jpg">
<meta property="og:updated_time" content="2018-11-12T01:38:38.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Mac 开发的神秘面纱：后娘养的嫡长子">
<meta name="twitter:description" content="本来，标题是「揭开 macOS 开发的神秘面纱」，可想想，以我目前对 macOS 开发的理解，还是去掉「揭开」二字吧 😂 本文不是系统性的文章，更像是 随笔。回想自己过去 1.6 年的 macOS 开发历程，挑些有意思的来说。如果想看完就去挖 macOS 这座金矿（如果是的话），你会失望的；且作佚事来读吧。 注：严格地说，应该叫作「macOS 开发」，因为去年起，苹果将 Mac 操作系统更名为">
<meta name="twitter:image" content="https://ps.toolinbox.net/bx86a.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: false,
    motion: false,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://atjason.com/IndieDev/2017-07-18.html"/>





  <title>Mac 开发的神秘面纱：后娘养的嫡长子 | Jason</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  




<script async src="https://www.googletagmanager.com/gtag/js?id=G-X6LH13XH9Q"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-X6LH13XH9Q');
</script>











  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Jason</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">独立开发，自由职业</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-links">
          <a href="/links" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-link"></i> <br />
            
            友链
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocapitalize="off" autocomplete="off" autocorrect="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://atjason.com/IndieDev/2017-07-18.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://ps.toolinbox.net/ezw8l.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Mac 开发的神秘面纱：后娘养的嫡长子
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-18T22:00:00+08:00">
                2017-07-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/IndieDev/" itemprop="url" rel="index">
                    <span itemprop="name">IndieDev</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><img src="https://ps.toolinbox.net/bx86a.png" alt=""></p>
<p>本来，标题是「揭开 macOS 开发的神秘面纱」，可想想，以我目前对 macOS 开发的理解，还是去掉「揭开」二字吧 😂</p>
<p>本文不是系统性的文章，更像是 <strong>随笔</strong>。回想自己过去 1.6 年的 macOS 开发历程，挑些有意思的来说。如果想看完就去挖 macOS 这座金矿（如果是的话），你会失望的；<strong>且作佚事来读吧</strong>。</p>
<p>注：严格地说，应该叫作「<strong>macOS 开发</strong>」，因为去年起，苹果将 Mac 操作系统更名为 macOS；不过，苹果电脑依旧以 Mac 命名，如 MacBookPro，故而 Mac 开发也说得过去；再加上，以小写字母开头作为文章名，总觉得怪怪的，是以本文混用「Mac 开发」与「macOS 开发」</p>
<p>—– 长文开始警戒线；不喜请绕行 —–</p>
<p><img src="https://ps.toolinbox.net/syxbc.jpg" alt=""></p>
<a id="more"></a>
<h2 id="0-Mac-是后娘养的嫡长子"><a href="#0-Mac-是后娘养的嫡长子" class="headerlink" title="0) Mac 是后娘养的嫡长子"></a>0) Mac 是后娘养的嫡长子</h2><p>说 Mac 是嫡长子，是因为 <strong>苹果就是做电脑起家的</strong>。虽说后来 iPod、iPhone 风生水起，但嫡长子的血统还是纯正的；而 iOS 正是基于 macOS 开发的。这里的故事很多，感兴趣可以读读《乔布斯传》之类的书或文章。</p>
<p>可惜的是，<strong>有了 iPhone 这棵摇钱树之后，Mac 电脑靠边站了</strong>，macOS 自然也被冷落，不到万不得已，不更新；即使更新，也像挤牙膏一样。</p>
<p><strong>Mac 哪里被冷落了？多了去了。</strong></p>
<p>比如，我每周都会收到一款苹果给开发者的邮件，本意是告知本周 App 的活跃程度。而我每次收到的邮件内容都是这样的：</p>
<p><img src="https://ps.toolinbox.net/734na.jpg" alt=""></p>
<p>因为我尚未上架 iOS 应用、只有 macOS App；而 <strong>在苹果看来，macOS App 岂能叫 App ？！</strong>是以，这里的数据是空的…</p>
<p>其它的，不胜枚举。</p>
<h2 id="1-Mac-是个小市场"><a href="#1-Mac-是个小市场" class="headerlink" title="1) Mac 是个小市场"></a>1) Mac 是个小市场</h2><p><strong>有多小？</strong></p>
<p><strong>先说说硬件</strong>，这是 2016 第四季度出货量对比：</p>
<table>
<thead>
<tr>
<th>设备</th>
<th>出货量</th>
<th>营收</th>
</tr>
</thead>
<tbody>
<tr>
<td>Mac</td>
<td>537 万</td>
<td>72 亿美元</td>
</tr>
<tr>
<td>iPhone</td>
<td>7,830 万</td>
<td>543 亿美元</td>
</tr>
</tbody>
</table>
<p>不论是出货量、还是营收，均是零头。</p>
<p><strong>再来看看 App 的数量：</strong></p>
<p>从 <a href="http://appshopper.com/" target="_blank" rel="external">AppShopper</a> 的数据来看，<strong>不足 3 万的 macOS App 数量，不到 iOS App 的 1%</strong>；对，是「百分之一」，<strong>零头的零头</strong>。</p>
<p><img src="https://ps.toolinbox.net/qg8nb.jpg" alt=""></p>
<p>当然，这里主要统计的是上架 MAS (Mac App Store) 的应用，在 MAS 之外也有很多。不过，2 个数量级的差异，没跑。</p>
<p><strong>现说说操作系统占比：</strong></p>
<p>据 <a href="https://netmarketshare.com/" target="_blank" rel="external">MarketShare</a> 的数据，<strong>macOS 仅占 6.12%，仅有 Windows 用户的 6.7%.</strong></p>
<p><img src="https://ps.toolinbox.net/d40yo.jpg" alt=""></p>
<p>其中，<strong>macOS 版本的分散程度</strong>，虽比 Windows 好很多，但也 <strong>不如 iOS:</strong></p>
<p><img src="https://ps.toolinbox.net/vsz2g.jpg" alt=""></p>
<p>看到这里，是不是觉得有些心凉，<strong>觉得 Mac 好可怜有没有…</strong></p>
<p>不过，Mac 电脑确实是在慢慢增加的，知名度也在变高。比如，<strong>国内现代都市剧中出现的电脑，大多都是 Mac</strong>；苹果也刚刚宣布 <strong>全球 Mac 活跃用户有 1 亿</strong>。</p>
<p><img src="https://ps.toolinbox.net/5pb5e.jpg" alt=""></p>
<h2 id="2-Swift-or-Objective-C"><a href="#2-Swift-or-Objective-C" class="headerlink" title="2) Swift or Objective-C"></a>2) Swift or Objective-C</h2><p><strong>我开发的应用 (<a href="https://toolinbox.net/Klib/" target="_blank" rel="external">Klib</a>、<a href="https://toolinbox.net/iPic/" target="_blank" rel="external">iPic</a>、<a href="https://toolinbox.net/iPic/iPicMover.html" target="_blank" rel="external">iPic Mover</a>、<a href="https://toolinbox.net/iPaste/" target="_blank" rel="external">iPaste</a>、<a href="https://toolinbox.net/iTimer/" target="_blank" rel="external">iTimer</a>、<a href="https://toolinbox.net/iHosts/" target="_blank" rel="external">iHosts</a>)，全部基于 Swift；不过，即使你也打算基于 Swift，还是建议对 Objective-C 有基本的了解。</strong>因为，毕竟 Objective-C 是苹果一直以来使用的开发语言，绝大多数的文档、教程，都是基于 Objective-C 的。</p>
<p>虽说可以很容易地改编为 Swift、或被 Swift 调用，但这就像是：你有一本英文词典，理论上就可以直接看英文文章，因为看见不懂的单词可以查嘛；但也知道，这不现实，毕竟你总不能每个单词都查吧？</p>
<p><strong>所以：</strong></p>
<ul>
<li>如果你已经有 Objective-C 基础，就直接使用 Objective-C 开发 Mac 应用好了。要不要学 Swift？看你自己心情，我不提供建议；</li>
<li>如果你并没有 Objective-C 基础，建议你先学学 Objective-C 基础，然后再学 Swift，并基于 Swift 开发。</li>
</ul>
<h2 id="3-Mac-文档及教程"><a href="#3-Mac-文档及教程" class="headerlink" title="3) Mac 文档及教程"></a>3) Mac 文档及教程</h2><p>官方文档主要有这些：</p>
<ul>
<li><a href="https://developer.apple.com/macos/" target="_blank" rel="external">macOS 开发者中心</a></li>
<li><a href="https://developer.apple.com/documentation/" target="_blank" rel="external">API Reference</a></li>
<li>Programming Guide<ul>
<li>主要是对具体知识点的详细介绍，如 <a href="https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/TableView/Introduction/Introduction.html" target="_blank" rel="external">Table View Programming Guide for Mac</a></li>
</ul>
</li>
<li><a href="https://developer.apple.com/videos/" target="_blank" rel="external">历年 WWDC 视频</a></li>
<li><a href="https://developer.apple.com/library/content/navigation/#section=Platforms&amp;topic=macOS" target="_blank" rel="external">Guides and Sample Code</a><ul>
<li>这里提供了一些示例项目。比如，想学某个控件的实际用法，可以到这里搜搜看。</li>
</ul>
</li>
</ul>
<p>实际上，由于我们一般是「<strong>面向 Google 编程</strong>」，一般遇到问题都是先搜索，不太需要记录这些网址。只是，如果你想系统性、深入地学习某个点时，可以正向地从官方文档入手。</p>
<p>不过，对于 <strong>苹果的开发文档</strong>，友情提醒：<strong>并不怎么好</strong>。如果套用这句话：<br>「为什么懂得这么多道理，却仍过不好这一生？」</p>
<p>便是：<br>「<strong>为什么我看了所有 Mac 文档，却仍无法开发 Mac 应用？</strong>」</p>
<p>文档更多是偏向对某个具体知识点的介绍，而如果想系统性地入门 macOS，最好是通过一本好的书，以及自己的练习。由于 iPhone 的热销，市面上 iOS 的书，可谓汗牛充栋。而 <strong>macOS 的书呢？呵呵</strong>。</p>
<p>我自己是看《<a href="https://www.bignerdranch.com/books/cocoa-programming/" target="_blank" rel="external">Cocoa Programming for Mac OS X</a>》这本书入门 macOS 开发的，这几乎是我在 2015 年能找到的唯一一本基于 Swift 的 macOS 开发教程。另外一本是 <a href="https://book.douban.com/subject/26410821/" target="_blank" rel="external">Swift Development with Cocoa</a>，跟这本书没法比。</p>
<p>其他 macOS 的书，我看的不多，也没什么好推荐的。如果你有觉得哪本书不错，欢迎留言告诉我。</p>
<h2 id="4-macOS-数据结构及持久化"><a href="#4-macOS-数据结构及持久化" class="headerlink" title="4) macOS 数据结构及持久化"></a>4) macOS 数据结构及持久化</h2><p>首先要说的是，<strong>虽说是 macOS 开发，但实际上很多基础的东西都是通用的</strong>，比如 JSON 格式、MySQL 数据库等等。</p>
<p>另外，<strong>macOS 和 iOS 相比</strong>，像 TouchBar 这种独有的东西，并不多；<strong>更多的是通用的</strong>，或者说是并行的两套。</p>
<p><strong>使用 plist 文件存储数据：</strong></p>
<ul>
<li>默认仅支持简单的数据结构；此方式仅适合保存少量数据，如偏好设置中的 On/Off 选项</li>
<li>可使用 <code>UserDefaults</code> 管理默认的 plist 文件。注意：沙盒模式和普通模式下默认的 plist 文件的位置不同</li>
<li>可在命令行中使用 <code>defaults</code> 命令来管理 plist 文件中的数据</li>
<li>可使用 Xcode 打开 plist 文件进行管理</li>
</ul>
<p><strong>序列化后存储：</strong></p>
<ul>
<li>对于自定义类型，适配 <code>NSSecureCoding</code> 协议后，可使用 <code>NSKeyedArchiver</code> 转换为 <code>Data</code> 格式</li>
<li>进而，可存储在普通文件中，也可存储于 plist 文件中</li>
</ul>
<p><strong>Core Data:</strong></p>
<ul>
<li>Core Data 本质上是对数据访问方式的封装</li>
<li>对于简单的数据结构，使用 Core Data 会带来额外的复杂度，并不划算。对于复杂的应用，Core Data 可以显著减少代码量</li>
<li>持久化方面，Core Data 提供了对象-关系映射 (ORM) 的功能，不编写任何SQL语句，即可将数据保存在 SQLite 数据库文件中，也能还原到内存中</li>
</ul>
<p><strong>CloudKit:</strong></p>
<ul>
<li>存储方面，CloudKit 本质上类似于云端的关系数据库</li>
<li>除了存储，CloudKit 更有用的场景，是在多设备、macOS 与 iOS 间同步数据。比如，系统自带的 Notes 等应用，均是通过 CloudKit 来存储、同步数据。其中，通知机制可以最小化需要同步的数据量</li>
<li>再有，就是提供基于 CloudKit 的共享功能</li>
</ul>
<p>注：数据持久化存储方式有非常多，也要视具体的需求而定；这里仅提及一些常用的方式。</p>
<h2 id="5-macOS-界面开发"><a href="#5-macOS-界面开发" class="headerlink" title="5) macOS 界面开发"></a>5) macOS 界面开发</h2><p>我们所说 macOS 开发，通常默认指开发「有界面及交互的、能运行在 macOS 上的应用」，<strong>其核心，就在于界面及交互</strong>。</p>
<p>我们也常听到 Cocoa，那 <strong>什么是 Cocoa 呢？</strong>援引《Cocoa Programming for OS X》中的介绍：</p>
<blockquote>
<p>Cocoa is your application’s interface to the window server to receive events and draw to the screen. At the same time it has access to the Unix layer where it can make lower level calls.</p>
</blockquote>
<p><img src="https://ps.toolinbox.net/1h5z5.jpg" alt=""></p>
<p>也就是说，<strong>Cocoa 是这样一个中间环节：负责衔接你的应用与窗口系统，同时也可直接操作系统底层。</strong></p>
<p><strong>界面的开发，是个无底洞</strong>；可以是个简单的单窗口应用，也可以是 Pages、iMovie 这样复杂的应用。</p>
<p><strong>对于初学者，建议从菜单栏程序入手</strong>。可以暂时绕开窗口、控件这些复杂的话题，又可以创建出能解决实际问题的一些应用。比如，iPic 主交互即位于菜单栏：</p>
<p><img src="https://ps.toolinbox.net/th82z.png" alt=""></p>
<p>这部分，可参见我之前写的教程：<a href="https://en.atjason.com/Cocoa/Status%20Bar%20App.html" target="_blank" rel="external">Status Bar App</a> 教程是 16 年 4 月写的，现在来看有些可能已经过时，比如当时是基于 Swift 2.2；不过整体还是可以参考的。</p>
<p>回到界面的开发。首先，<strong>要理解 App 的整体生命周期。</strong>尤其是 App 启动时，都做了哪些事、先后顺序及依赖是什么。</p>
<p>然后，<strong>实际的工作，就是搞定界面布局，以及熟悉一个个控件的用法</strong>，如 NSButton、NSTextField、NSTableView 等等。<strong>建议的学习步骤：</strong></p>
<ul>
<li>先随意玩玩，能让控件跑起来；一些控件复杂，跑不起来也不用觉得沮丧</li>
<li>如果官方有 Programming Guide，认真读一遍</li>
<li>如果官方有示例程序，学习之，熟悉正确的用法</li>
<li>过一遍 API Reference，了解控件所有的可能性和局限</li>
<li>解决自己实际的问题，真正用起来</li>
</ul>
<p><strong>我一般的开发步骤：</strong></p>
<ul>
<li>想清楚数据结构</li>
<li>堆 UI</li>
<li>完成业务逻辑</li>
</ul>
<h2 id="6-macOS-设计模式之解耦"><a href="#6-macOS-设计模式之解耦" class="headerlink" title="6) macOS 设计模式之解耦"></a>6) macOS 设计模式之解耦</h2><p>随着程序变得复杂，代码变多，也很容易交织在一起。对于进一步开发和维护，是非常头痛的事。</p>
<p><img src="https://ps.toolinbox.net/xnxnn.png" alt=""></p>
<p>怎么避免这样的情况呢？其中一个思路是：<strong>解耦</strong>。</p>
<p>抽象的说，就是 <strong>把复杂的东西拆成一个个独立的模块，然后通过一些方式让这些模式有机地组合在一起</strong>。</p>
<p>有哪些方式呢？顺着这个思路，我列出一些概念。</p>
<p><strong>MVC模式 (Model-View-Controller)</strong></p>
<ul>
<li>这一模式在界面开发里大量使用，比如你经常看到的 XXViewController，就是其中的 Controller 部分</li>
<li>简单的说，就是 <strong>把界面与逻辑分离</strong>。界面部分，如布局、样式等。通常，代码量最多的，都是在 Controller 中。View 与 Controller 之间，<strong>通过引用、绑定来传递数据</strong>，即将数据显示在界面中、从界面读取用户产生的数据</li>
</ul>
<p><strong>Delegate</strong></p>
<ul>
<li>有两个角度来理解代理。以 NSWindowDelegate 为例，可理解为 Window 本身有丰富的可定制性，程序可选择性地实现某些功能、特性</li>
<li>另一个角度是，同样对于 NSWindowDelegate，对事件（如窗口即将关闭）的响应，Window 本身是不知道的，或者说是具体的业务相关的。Window 自己做不到，只能委托给自己的「代理」去决定。比如，当窗口即将关闭时，程序提示用户保存未保存的数据</li>
</ul>
<p><strong>Callback</strong></p>
<ul>
<li>对于非实时的操作，可以使用 Callback 回调的方式，来解耦调用者和执行者之间的等待</li>
<li>比如，程序在从网络下载图片时，可能需要 1ms，也可能需要 2s，程序总不能傻等着。于是，程序告诉下载的模块：我去忙别的事了，你下载好了告诉我。怎么告诉？就是通过 Callback 回调机制实现</li>
<li>与之关联的概念，如代码块</li>
</ul>
<p><strong>Notification</strong></p>
<ul>
<li>对于「<strong>如果…就…</strong>」这样的逻辑，比较适合的是通知机制</li>
<li>这里的通知，不止是从网络上推送下来的通知，也可以是程序内部的通知</li>
<li>比如，用户在偏好设置的界面中完成账户升级后，在程序内发出账户类型变更的通知；程序的主窗口之前注册以监听这一通知，便可根据账户类型实时调整界面</li>
</ul>
<h2 id="7-发布-macOS-应用"><a href="#7-发布-macOS-应用" class="headerlink" title="7) 发布 macOS 应用"></a>7) 发布 macOS 应用</h2><p>自己辛苦开发的程序，通常是愿意让更多人来用的。如果能赚点小钱，当然更好啦。</p>
<p><img src="https://ps.toolinbox.net/jxzr4.jpg" alt=""></p>
<h3 id="7-0-macOS-应用签名"><a href="#7-0-macOS-应用签名" class="headerlink" title="7.0) macOS 应用签名"></a>7.0) macOS 应用签名</h3><p>对于简单的程序，可以复制到别的电脑上运行，但最好还是要对程序进行签名。尤其是使用 CloudKit 等一些苹果特性的程序，必须签名。</p>
<p>怎么签名呢？前提是交钱。也就是，<strong>必须每年交给苹果 $99 的人头税，才能成为苹果开发者</strong>，进而给应用签名。</p>
<h3 id="7-1-MAS-与沙盒模式"><a href="#7-1-MAS-与沙盒模式" class="headerlink" title="7.1) MAS 与沙盒模式"></a>7.1) MAS 与沙盒模式</h3><p><strong>在 MAS (Mac App Store) 上提交的应用，必须运行在沙盒模式中。</strong></p>
<p><strong>沙盒模式有诸多限制</strong>，比如，默认不能访问用户的任何文件、一些接口无法使用等等。<strong>和 iOS 的沙盒模式相比，macOS 的沙盒模式还是宽松很多的</strong>。以访问文件的权限为例，应用可以申请访问如 Downloads 等指定目录。向谁申请呢？苹果，而不是用户。一旦通过（虽然并不容易），便可直接访问该目录，无需用户授权。</p>
<p>事实上，<strong>沙盒模式确实限制了程序的发挥空间</strong>，一些应用（如屏幕取词翻译、截图工具）干脆无法上架，或者额外开通「Accessibility」权限才能正常工作。而据说苹果已不再放行需要此权限的应用上架。</p>
<h3 id="7-2-MAS-付费方式"><a href="#7-2-MAS-付费方式" class="headerlink" title="7.2) MAS 付费方式"></a>7.2) MAS 付费方式</h3><p>苹果支持多种内购方式，要想通过应用收费，最简单的方式是：<strong>设置程序必须付费才能下载</strong>。这样，程序内无需区分免费版与高级版，无需做任何功能限制，代码简单。苹果系统保证了，使用哪个 Apple ID 下载的应用，只能在使用哪个 Apple ID 上登录的电脑上使用。比如，<strong>你自己购买了某个付费应用，直接把 .app 复制到朋友的电脑上，是无法运行的</strong>。</p>
<p>不过，这一方式也有局限：用户在付费之前，无法体验到产品的所有功能，也就很难决定是否要付费。对于这一局限，一些程序的做法时：在产品官网提供一个全功能、但仅能运行一段时间（如 7 天）的 <strong>体验版</strong>。这样，用户可以在体验所有功能后，决定是否购买。</p>
<p>再进一步，就是 <strong>免费版 + 内购的模式</strong>。用户可免费下载应用，但应用仅开放基础功能，需要内购才能使用高级功能。这样，既能最大化地获取用户，又能适时地收费，我的所有应用都采用此方式，相信也是未来一段时间的趋势。</p>
<p><strong>对于内购，又分为一次性购买和订阅制</strong>。一次性购买容易理解；订阅制可以有按月、季度、年等不同周期。对于订阅制，又分为自动续订和手动续订。目前，苹果对于订阅制、尤其是自动续订的订阅制，审核较严。</p>
<p>另外，还有 <strong>消耗型内购</strong>，这种在游戏中较为常见，比如花钱买装备，或者为账户充值等。</p>
<p><strong>对于内购的开发</strong>，还是比较繁琐的，比如要处理展示、购买、用户购买后退款、恢复、订阅续订、订阅未续订导致过期等等逻辑。好在，<strong>我封装了 <a href="https://github.com/atjason/IAPHelper" target="_blank" rel="external">IAPHelper</a></strong>，可以很方便地处理这些逻辑（如下代码为购买部分）；<strong>开源</strong>，可以 Pod 方式集成，已经在我的产品中应用多年，大家可放心使用。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"> <span class="type">IAP</span>.purchaseProduct(productIdentifier, handler: &#123; (productIdentifier, error) <span class="keyword">in</span></div><div class="line">	<span class="keyword">if</span> <span class="keyword">let</span> identifier = productIdentifier &#123;</div><div class="line">		<span class="comment">// The product of 'productIdentifier' purchased.</span></div><div class="line">	     </div><div class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="keyword">let</span> error = error <span class="keyword">as</span>? <span class="type">NSError</span> &#123;</div><div class="line">      <span class="keyword">if</span> error.code == <span class="type">SKError</span>.<span class="type">Code</span>.paymentCancelled.rawValue &#123;</div><div class="line">		<span class="comment">// User cancelled</span></div><div class="line">        </div><div class="line">      &#125; <span class="keyword">else</span> &#123;</div><div class="line">		<span class="comment">// Some error happened</span></div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h3 id="7-3-不完美的-MAS"><a href="#7-3-不完美的-MAS" class="headerlink" title="7.3) 不完美的 MAS"></a>7.3) 不完美的 MAS</h3><p>之前苹果与微信怒怼的打赏分成事件，想必让更多朋友知道了：<strong>凡是应用从用户收到的钱，苹果均要收 30% 的拔毛费。</strong></p>
<p>MAS 的诸多限制，以及不菲的拔毛费，让很多知名的 macOS App 纷纷下架，如 Sketch、Dash 等等。</p>
<p>不过，<strong>要在 MAS 之外发布，还是要做很多事情的</strong>，比如下载、支付、退款、激活码等等。对于小程序，还是挺繁琐的，并不划算。另外，毕竟 MAS 还能带来一些自然流量。</p>
<p>如果在 MAS 之外发布，还有一点需要注意：<strong>.app 程序本质上是一个文件夹</strong>。如果需要在网络上传送（如作为邮件的附件），最好是进行压缩，甚至是制作 .dmg 文件，我使用的是 <a href="https://github.com/sindresorhus/create-dmg" target="_blank" rel="external">create-dmg</a> 这个小工具，非常方便，生成的样式也简单大方。</p>
<p>基于上面的原因，目前我的应用全部在 MAS 上发布，尚未在 MAS 之外发布。</p>
<h2 id="尾巴"><a href="#尾巴" class="headerlink" title="尾巴"></a>尾巴</h2><p>macOS 开发的话题还有非常多，比如 Storyboard、绑定、动画、并发、Undo、Pasteboard、Drag &amp; Drop、本地化、单元测试等等，本文不可能全部提及。并且，写起来也好累，毕竟必须对这些点有完全的掌握，才可能写出来。暂且挖坑，以后再填。</p>
<p>对 macOS 开发感兴趣？欢迎留言交流。</p>
<hr>
<p>原文：「<strong>自在开发</strong>」公众号</p>
<p><img src="https://ps.toolinbox.net/z997y.jpg" alt=""></p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/daily/2017-07-18.html" rel="next" title="0718 - 为何要写作">
                <i class="fa fa-chevron-left"></i> 0718 - 为何要写作
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/daily/2017-07-17.html" rel="prev" title="0717 - 畅想一下美好的事">
                0717 - 畅想一下美好的事 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="https://ps.toolinbox.net/ezw8l.jpg"
               alt="Jason" />
          <p class="site-author-name" itemprop="name">Jason</p>
           
              <p class="site-description motion-element" itemprop="description">记录一位独立开发者的精进之路，分享自由职业者的生存方式。</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/">
                <span class="site-state-item-count">3010</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">9</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/atjason" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/hereisjason" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  Twitter
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/atjasonzone" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              Links
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://toolinbox.net/" title="Toolinbox" target="_blank">Toolinbox</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#0-Mac-是后娘养的嫡长子"><span class="nav-number">1.</span> <span class="nav-text">0) Mac 是后娘养的嫡长子</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-Mac-是个小市场"><span class="nav-number">2.</span> <span class="nav-text">1) Mac 是个小市场</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-Swift-or-Objective-C"><span class="nav-number">3.</span> <span class="nav-text">2) Swift or Objective-C</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-Mac-文档及教程"><span class="nav-number">4.</span> <span class="nav-text">3) Mac 文档及教程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-macOS-数据结构及持久化"><span class="nav-number">5.</span> <span class="nav-text">4) macOS 数据结构及持久化</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-macOS-界面开发"><span class="nav-number">6.</span> <span class="nav-text">5) macOS 界面开发</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-macOS-设计模式之解耦"><span class="nav-number">7.</span> <span class="nav-text">6) macOS 设计模式之解耦</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-发布-macOS-应用"><span class="nav-number">8.</span> <span class="nav-text">7) 发布 macOS 应用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-0-macOS-应用签名"><span class="nav-number">8.1.</span> <span class="nav-text">7.0) macOS 应用签名</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-1-MAS-与沙盒模式"><span class="nav-number">8.2.</span> <span class="nav-text">7.1) MAS 与沙盒模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-2-MAS-付费方式"><span class="nav-number">8.3.</span> <span class="nav-text">7.2) MAS 付费方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-3-不完美的-MAS"><span class="nav-number">8.4.</span> <span class="nav-text">7.3) 不完美的 MAS</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#尾巴"><span class="nav-number">9.</span> <span class="nav-text">尾巴</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2011 - 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jason</span>
  <a href="https://beian.miit.gov.cn/" target="_blank">浙ICP备16002197号</a> 
</div>



        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>




















  
  <script type="text/javascript" src="https://cdn.bootcss.com/jquery/2.1.3/jquery.min.js"></script>

  
  <script type="text/javascript" src="https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js"></script>

  
  <script type="text/javascript" src="https://cdn.bootcss.com/jquery_lazyload/1.9.7/jquery.lazyload.min.js"></script>

  
  <script type="text/javascript" src="https://cdn.bootcss.com/velocity/1.2.1/velocity.min.js"></script>

  
  <script type="text/javascript" src="https://cdn.bootcss.com/velocity/1.2.1/velocity.ui.min.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  

    

    
      <script type="text/javascript">
        var disqus_config = function () {
          this.page.url = 'https://atjason.com/IndieDev/2017-07-18.html';
          this.page.identifier = 'IndieDev/2017-07-18.html';
          this.page.title = 'Mac 开发的神秘面纱：后娘养的嫡长子';
        };
        var d = document, s = d.createElement('script');
        s.src = 'https://atjason.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      </script>
    

  




	





  





  








  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      $('#local-search-input').focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            var resultItems = [];
            if (this.value.trim().length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCountInArticle = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword, i) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCountInArticle = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  var resultItem = '';

                  function highlightKeyword(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;

                    var matchText = text.substring(start, end);
                    var matchResult = [];
                    var prevEnd = 0;
                    while (position + word.length <= end && index.length != 0) {

                      // highlight keyword

                      var wordBegin = position - start;
                      var wordEnd = position - start + word.length;
                      matchResult.push(matchText.substring(prevEnd, wordBegin));
                      matchResult.push("<b class=\"search-keyword\">" + matchText.substring(wordBegin, wordEnd) + "</b>");

                      // move to next position of hit

                      index.pop();
                      prevEnd = wordEnd;
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (prevEnd > position - start) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    matchResult.push(matchText.substring(prevEnd));
                    return matchResult.join('');
                  }

                  // sort index by position of keyword

                  indexOfTitle.sort(function (itemLeft, itemRight) {
                    return itemRight.position - itemLeft.position;
                  });

                  indexOfContent.sort(function (itemLeft, itemRight) {
                    return itemRight.position - itemLeft.position;
                  });

                  // highlight title

                  if (indexOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, 0, title.length, indexOfTitle) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  // highlight content

                  var resultUpperBound = parseInt(1);
                  var withoutUpperBound = false;
                  if (resultUpperBound === -1) {
                    withoutUpperBound = true;
                  }
                  var currentResultNum = 0;
                  while (indexOfContent.length != 0 && (withoutUpperBound || (currentResultNum < resultUpperBound))) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    resultItem += "<a href='" + articleUrl + "'>" +
                    "<p class=\"search-result\">" + highlightKeyword(content, start, end, indexOfContent) +
                    "...</p>" + "</a>";
                    currentResultNum++;
                  }
                  resultItem += "</li>";
                  resultItems.push({item: resultItem, hitCount: hitCountInArticle, id: resultItems.length});
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              $resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              $resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.hitCount != resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultLeft.id - resultRight.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result, i) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              $resultContent.innerHTML = searchResultList;
            }
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>





  

  

  

  

  

</body>
</html>
